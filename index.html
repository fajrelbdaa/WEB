<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠØ¯Ø©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #logo {
            max-width: 200px; /* ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… */
            margin-bottom: 20px;
        }
        canvas {
            border: 1px solid #000;
            margin-top: 20px;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            width: 300px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
        }
    </style>
    <!-- ØªØ­Ù…ÙŠÙ„ Ø®Ø· Ù…Ø®ØµØµ Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ØºØ¨ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Ù…Ø®ØªÙ„Ù -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡ Ø¨Ø³Ù‡ÙˆÙ„Ø© -->
    <img id="logo" src="logo.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹" />

    <h1>Ø£Ù†Ø´Ø¦ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠØ¯Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</h1>
    <input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" />
    <br>
    <button onclick="generateCard()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
    <button onclick="downloadCard()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
    <br>
    <canvas id="cardCanvas" width="800" height="800"></canvas>

    <script>
        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
        window.onload = function () {
            const canvas = document.getElementById("cardCanvas");
            const ctx = canvas.getContext("2d");

            const image = new Image();
            image.src = "template.jpg";  // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø³Ø§Ø± ØµØ­ÙŠØ­

            image.onload = function () {
                console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!");
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
            };

            image.onerror = function () {
                console.error("âš ï¸ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©! ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±.");
            };
        };

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø§Ø³Ù…
        function generateCard() {
            const name = document.getElementById("nameInput").value;
            if (!name) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…!");
                return;
            }

            const canvas = document.getElementById("cardCanvas");
            const ctx = canvas.getContext("2d");

            const image = new Image();
            image.src = "template.jpg"; // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø³Ø§Ø± ØµØ­ÙŠØ­

            image.onload = function () {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Øµ (ØªØ®ØµÙŠØµ Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ù„ÙˆÙ†)
                ctx.font = "40px 'Tajawal', Bold";  // ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ø· Ø¥Ù„Ù‰ "Amiri" Ù…Ù† Google Fonts (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ø®Ø· Ù‡Ù†Ø§)
                ctx.fillStyle = "#1e4998";  // Ù„ÙˆÙ† Ø§Ù„Ù†Øµ (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ø¥Ù„Ù‰ Ø£ÙŠ Ù„ÙˆÙ† ØªØ±ÙŠØ¯Ù‡)
                ctx.textAlign = "center";

                // ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø³Ù…
                const textX = canvas.width / 2;
                const textY = canvas.height - 180;

                ctx.fillText(name, textX, textY);
                
                // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                canvas.setAttribute("data-updated", "true");
            };
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        function downloadCard() {
            const canvas = document.getElementById("cardCanvas");

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ Ù‚Ø¯ ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡
            if (!canvas.getAttribute("data-updated")) {
                alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø¹Ø¯! Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' Ø£ÙˆÙ„Ø§Ù‹.");
                return;
            }

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Blob
            canvas.toBlob(function (blob) {
                const fileName = "Ø¨Ø·Ø§Ù‚Ø©_Ø§Ù„Ù…Ø¹Ø§ÙŠØ¯Ø©.png";
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

                if (window.showSaveFilePicker && !isMobile) {
                    // âœ… Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…ÙƒØ§Ù† Ø§Ù„Ø­ÙØ¸
                    saveFileWithPicker(blob, fileName);
                } else {
                    // âœ… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    saveFileDirectly(blob, fileName);
                }
            }, "image/png");
        }

        // ğŸ“Œ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…ÙƒØ§Ù† Ø§Ù„Ø­ÙØ¸
        async function saveFileWithPicker(blob, fileName) {
            try {
                const handle = await window.showSaveFilePicker({
                    suggestedName: fileName,
                    types: [
                        {
                            description: "PNG Image",
                            accept: { "image/png": [".png"] },
                        },
                    ],
                });

                const writable = await handle.createWritable();
                await writable.write(blob);
                await writable.close();
            } catch (error) {
                console.error("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸:", error);
            }
        }

        // ğŸ“Œ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: Ø§Ù„ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
        function saveFileDirectly(blob, fileName) {
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
